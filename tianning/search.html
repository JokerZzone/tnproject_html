<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<style>
			.mui-search .mui-placeholder {
				text-align: left;
			}
			.mui-input-row.mui-search .mui-icon-clear {
				right: 12%;
			}
		</style>
	</head>

	<body>
		<div class="mui-input-row mui-search" style="margin:0 auto;margin-top: 5px;width: 95%;">
		    <input id="projectSearch" type="search" class="mui-input-clear mui-pull-left" placeholder="搜索" autofocus="autofocus" style="width: 88%;">
		    <a class="mui-action-back mui-pull-right" style=" width: 12%; text-align: center; line-height: 34px;">取消</a>
		</div>
		<div class="mui-content">
			<ul id="OA_task_1" class="mui-table-view" style="margin: 0;">
				<li id="" class="mui-table-view-cell list_all_data" style="display: none;">
					<div class="mui-slider-right mui-disabled roleControl">
						<a class="mui-btn mui-btn-red">删除</a>
					</div>
					<div class="mui-slider-handle">
						<a id="list_all_a" class="mui_row_ul list_all_a mui-pull-left mui-col-xs-10" href="#" style="display:block;height:45px; color:#333;">
							<span class="mui-col-xs-2 list1 mui-pull-left mui-text-center" style="display:block;line-height:45px;">1</span>
							<span class="mui-col-xs-10 list2 mui-pull-left" style="display:block;line-height:45px;" name="name">2</span>
						</a>
							<span class="location mui-icon mui-icon-location mui-pull-left mui-col-xs-2 mui-text-center" style="display:block;color:#0090ff;line-height: 45px;"></span>
					</div>
				</li>
			</ul>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/url.js"></script>
		<script type="text/javascript">
			mui.init();
//		  获取页面url的type和content
			function getUrlParam(key){
			    // 获取参数
			    var url = window.location.search;
			    // 正则筛选地址栏
			    var reg = new RegExp("(^|&)"+ key +"=([^&]*)(&|$)");
			    // 匹配目标参数
			    var result = url.substr(1).match(reg);
			    //返回参数值
			    return result ? decodeURIComponent(result[2]) : null;
			}
			var type=getUrlParam("type");
			var name = getUrlParam("name");
			if(name=="全部项目"){
				type=0;
				name="null";
			}else if(name=="全部"){
				type=0;
				name="null";
			}
		
//  手机键盘搜索
	document.getElementById("projectSearch").addEventListener("keypress",function(event) {
    if(event.keyCode == "13") {
       document.activeElement.blur();//收起虚拟键盘
     
     	var ProjectSearchName = document.getElementById("projectSearch").value;
		var token = sessionStorage.getItem('token');
    	mui.ajax(commonUrl+'/android/project/projectSearch;jsessionid='+token,{
			data:{
				type:0,
				name:"",
				content:ProjectSearchName
			},
			type:'post',//HTTP请求类型
			timeout:10000,//超时时间设置为10秒；
			success:function(data){
				//服务器返回响应，根据响应结果，分析是否登录成功；
				if(data.code==1){
					$("#OA_task_1").find(".list_all_data").remove();
					if(data.data.length==0){
						mui.alert("没有相关的项目");
					}
					for(var i=0;i<data.data.length;i++){
						console.log(data.data[i].lockStatus);
						var str ="";
						str = '<li class="mui-table-view-cell list_all_data">'+
							'<div class="mui-slider-handle">'+
								'<a id="'+data.data[i].id+'" class="mui_row_ul list_all_a mui-pull-left mui-col-xs-10" href="#" style="display:block;height:45px; color:#333;" kay="'+data.data[i].name+'" lockstatus="'+data.data[i].lockStatus+'">'+
									'<span class="mui-col-xs-2 list1 mui-pull-left mui-text-center" style="display:block;line-height:45px;">'+(i+1)+'</span>'+
									'<span class="mui-col-xs-10 list2 mui-pull-left" style="display:block;line-height:45px;" name="name">'+data.data[i].name+'</span>'+
								'</a>'+
									'<span id="'+data.data[i].id+'" class="location mui-icon mui-icon-location mui-pull-left mui-col-xs-2 mui-text-center" style="display:block;color:#0090ff;line-height: 45px;"></span>'+
							'</div>'+
						'</li>'
						$("#OA_task_1").append(str);
					}
				$("#projectSearch").val("");
				  ProjectSearchName = "";
				}
			},
			error:function(){
				//异常处理；
				alert("没有查询到项目名称");
			}
		});
      
      	toSearch();//TODO 完成搜索事件
        event.preventDefault(); // 阻止默认事件---阻止页面刷新
        
    	}
	});
//		点击进入详情列表页面
		mui("#OA_task_1").on('tap', '.list_all_a', function() {
				//获取id
			var id = this.getAttribute("id");
			var titleName = this.getAttribute("kay");
			var lockstatus = this.getAttribute("lockstatus");
			mui.openWindow({
			    url: 'list_all_data.html?id='+id+'&titleName='+titleName+'&lockstatus='+lockstatus, 
			    id:'list_all_data_detail'
			  });
			})
		mui("#OA_task_1").on('tap', '.mui-icon-location', function() {
				//获取id
			var id = this.getAttribute("id");
				mui.openWindow({
				    url: 'map.html?id='+id, 
				    id:'map'
				});
			})
	
		</script>
	</body>

</html>